<html metal:use-macro="view/@@standard_macros/page" i18n:domain="schooltool">
<head>
  <title metal:fill-slot="title" i18n:translate=""
    >Attendance of <span i18n:name="person" i18n:translate=""
           tal:replace="context/title"/></title>
</head>
<body>

<metal:block metal:fill-slot="content-header">
<h2 i18n:translate="">Attendance of <span i18n:name="person"
    tal:replace="context/title" /></h2>
</metal:block>

<metal:block metal:fill-slot="body"
             tal:define="unresolved_absences
                            python:list(view.unresolvedAbsencesForDisplay());
                         unresolved_explained_absences
                            python: [ar for ar in unresolved_absences
                                     if ar['explanation']];
                         unresolved_unexplained_absences
                            python: [ar for ar in unresolved_absences
                                     if not ar['explanation']];">

<div class="info" tal:repeat="status view/statuses"
     tal:content="status" i18n:translate="">
  (status message)
</div>
<div class="error" tal:repeat="error view/errors"
     tal:content="error" i18n:translate="">
  (error message)
</div>

<tal:else condition="not:unresolved_absences">
<p i18n:translate="">There are no unresolved absences.</p>
</tal:else>

<tal:if_there_are_any_explained condition="unresolved_explained_absences">

<form id="attendance_explain_resolve" action="." method="post"
      tal:attributes="action request/URL">

<h3 i18n:translate="">Unresolved explained absences</h3>

<div class="attendance_record"
     tal:repeat="absence unresolved_explained_absences">
  <input type="checkbox" tal:attributes="name absence/id; id absence/id" />
  <label tal:attributes="for absence/id" tal:content="absence/text"
         i18n:translate="" />
  <div class="explanation" tal:content="absence/explanation">
    (explanation)
  </div>
</div>

<div class="row">
  <div class="row" tal:define="widget nocall:view/code_widget">
    <div metal:use-macro="context/@@form_macros/widget_row" />
  </div>
</div>

<div class="row">
  <div><input type="radio" name="resolve" id="do_not_resolve" value=""
              checked="checked" />
  <label for="do_not_resolve">Do not resolve</label>
  </div>
  <div><input type="radio" name="resolve" id="accept" value="accept" />
  <label for="accept">Accept</label>
  </div>
  <div><input type="radio" name="resolve" id="reject" value="reject" />
  <label for="reject">Reject</label>
  </div>
</div>

<div class="controls">
  <input type="submit" class="button-ok" name="UPDATE" value="Update" />
</div>

</form>
</tal:if_there_are_any_explained>

<tal:if_there_are_any_unexplained condition="unresolved_unexplained_absences">

<form id="attendance_explain_resolve" action="." method="post"
      tal:attributes="action request/URL">

<h3 i18n:translate="">Unresolved unexplained absences</h3>

<div class="attendance_record"
     tal:repeat="absence unresolved_unexplained_absences">
  <input type="checkbox" tal:attributes="name absence/id; id absence/id" />
  <label tal:attributes="for absence/id" tal:content="absence/text"
         i18n:translate="" />
</div>

<div class="row">
  <div class="label">
  <label for="explanation">Add an explanation<label>
  </div>
  <div class="field">
  <textarea id="explanation" name="explanation" cols="60" rows="5"></textarea>
  </div>
</div>

<div class="row">
  <div><input type="radio" name="resolve" id="do_not_resolve" value=""
              checked="checked" />
  <label for="do_not_resolve">Do not resolve</label>
  </div>
  <div><input type="radio" name="resolve" id="accept" value="accept" />
  <label for="accept">Accept</label>
  </div>
  <div><input type="radio" name="resolve" id="reject" value="reject" />
  <label for="reject">Reject</label>
  </div>
</div>

<div class="controls">
  <input type="submit" class="button-ok" name="UPDATE" value="Update" />
</div>

</form>
</tal:if_there_are_any_unexplained>

<tal:summary_by_term define="terms python:list(view.summaryPerTerm())">
<h2 i18n:translate="">Summary</h2>

<p i18n:translate="" tal:condition="not:terms">There are no terms defined.</p>

<table class="attendance_summary_per_term" tal:condition="terms">
<tr><th i18n:translate="" rowspan="2">Term</th><th colspan="2">Homeroom attendance</th><th colspan="2">Section attendance</th></tr>
<tr><th i18n:translate="">Absences</th><th i18n:translate="">Tardies</th><th i18n:translate="">Absences</th><th i18n:translate="">Tardies</th></tr>
<tr tal:repeat="term terms">
  <td><a tal:attributes="href string:?term=${term/name}" tal:content="term/title">(term)</a></td>
  <td class="number" tal:content="term/homeroom_absences">(h_a)</td>
  <td class="number" tal:content="term/homeroom_tardies">(h_t)</td>
  <td class="number" tal:content="term/section_absences">(s_a)</td>
  <td class="number" tal:content="term/section_tardies">(s_t)</td>
</tr>
</table>

<tal:if_detailed_summary_wanted define="term view/term_for_detailed_summary"
                                condition="term">
<h2 tal:content="term/title">(term)</h2>
<tal:block tal:define="absences python:list(view.absencesForTerm(term))">
<ul tal:condition="absences">
  <li tal:repeat="absence absences"
      tal:content="absence"
      i18n:translate="" />
</ul>
<tal:else condition="not:absences">
<p i18n:translate="">There were no absences in this term.</p>
</tal:else>
</tal:block>
</tal:if_detailed_summary_wanted>

</tal:summary_by_term>

</metal:block>
</body>
</html>
