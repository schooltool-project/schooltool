Attendance workflow
===================


Overview
--------

1. Set up logging subscriber
2. Start the process
3. Clean up

Setup
-----

Let's set up a subscriber that prints out all the events:

    >>> def log_workflow(event):
    ...     print event

    >>> import zope.event
    >>> from zope.app.testing.functional import setSite
    >>> zope.event.subscribers.append(log_workflow)
    >>> setSite(getRootFolder())

Now we can create the process:

    >>> from zope.app import zapi
    >>> pd = zapi.getUtility(zope.wfmc.interfaces.IProcessDefinition,
    ...                      name='schooltool.attendance.explanation')

    >>> from schooltool.attendance.attendance import AttendanceRecord
    >>> from schooltool.attendance.attendance import ABSENT
    >>> process = pd()
    >>> ar = AttendanceRecord(ABSENT)
    >>> process.start(ar)
    ProcessStarted(Process('schooltool.attendance.explanation'))
    Transition(None, Activity('schooltool.attendance.explanation.create'))
    ActivityStarted(Activity('schooltool.attendance.explanation.create'))
    ActivityFinished(Activity('schooltool.attendance.explanation.create'))
    Transition(Activity('schooltool.attendance.explanation.create'),
               Activity('schooltool.attendance.explanation.explain'))
    ActivityStarted(Activity('schooltool.attendance.explanation.explain'))

Let's make the attendance record a tardy:

    >>> from datetime import datetime
    >>> ar._work_item.makeTardy(datetime(2005, 1, 1, 10, 15))
    WorkItemFinished(u'WaitForExplanation')
    ActivityFinished(Activity('schooltool.attendance.explanation.explain'))
    Transition(Activity('schooltool.attendance.explanation.explain'),
               Activity('schooltool.attendance.explanation.makeTardy'))
    ActivityStarted(Activity('schooltool.attendance.explanation.makeTardy'))
    ActivityFinished(Activity('schooltool.attendance.explanation.makeTardy'))
    Transition(Activity('schooltool.attendance.explanation.makeTardy'),
               Activity('schooltool.attendance.explanation.explain'))
    ActivityStarted(Activity('schooltool.attendance.explanation.explain'))

Clean up:

    >>> zope.event.subscribers = zope.event.subscribers[:-1]
    >>> setSite(None)
