Functional tests for SchoolBell ACL ReSTive view
================================================

Initial state

    >>> print rest("""
    ... GET /persons/acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... """, handle_errors=False)
    HTTP/1.1 200 Ok
    Content-Length: ...
    Content-Type: text/html;charset=utf-8
    Set-Cookie: ...
    <BLANKLINE>
    <acl xmlns="http://schooltool.org/ns/model/0.1">
      <principal id="zope.Authenticated">
    <BLANKLINE>
          <permission setting="on" id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="zope.Anybody">
    <BLANKLINE>
          <permission id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.group.manager">
    <BLANKLINE>
          <permission id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.person.manager">
    <BLANKLINE>
          <permission setting="on" id="schooltool.view" />
          <permission setting="on" id="schooltool.edit" />
          <permission setting="on" id="schooltool.create" />
          <permission setting="on" id="schooltool.viewCalendar" />
          <permission setting="on" id="schooltool.addEvent" />
          <permission setting="on" id="schooltool.modifyEvent" />
          <permission setting="on" id="schooltool.controlAccess" />
          <permission setting="on"
                      id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
    </acl>
    <BLANKLINE>


Now, let's create some groups and persons:

    >>> print rest("""
    ... POST /groups/ HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... Content-Type: text/xml
    ...
    ... <object xmlns="http://schooltool.org/ns/model/0.1" title="A Group"/>
    ... """)
    HTTP/1.1 201 Created
    ...
    Location: http://localhost/groups/a-group
    Set-Cookie: ...
    <BLANKLINE>
    Object created: http://localhost/groups/a-group

    >>> print rest("""
    ... PUT /persons/john HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... Content-Type: text/xml
    ...
    ... <object xmlns="http://schooltool.org/ns/model/0.1" title="John"/>
    ... """)
    HTTP/1.1 201 Created
    ...

    >>> print rest("""
    ... PUT /persons/john/password HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ...
    ... ann
    ... """)
    HTTP/1.1 200 Ok
    Content-Length: 0
    Set-Cookie: ...
    <BLANKLINE>

Now, the ACL view should include those new principals as well:

    >>> print rest("""
    ... GET /acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... """)
    HTTP/1.1 200 Ok
    Content-Length: ...
    Content-Type: text/html;charset=utf-8
    Set-Cookie: ...
    <BLANKLINE>
    <acl xmlns="http://schooltool.org/ns/model/0.1">
      <principal id="zope.Authenticated">
    <BLANKLINE>
          <permission setting="on" id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="zope.Anybody">
    <BLANKLINE>
          <permission id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.group.a-group">
    <BLANKLINE>
          <permission id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.group.manager">
    <BLANKLINE>
          <permission id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.person.john">
    <BLANKLINE>
          <permission setting="on" id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.person.manager">
    <BLANKLINE>
          <permission setting="on" id="schooltool.view" />
          <permission setting="on" id="schooltool.edit" />
          <permission setting="on" id="schooltool.create" />
          <permission setting="on" id="schooltool.viewCalendar" />
          <permission setting="on" id="schooltool.addEvent" />
          <permission setting="on" id="schooltool.modifyEvent" />
          <permission setting="on" id="schooltool.controlAccess" />
          <permission setting="on"
                      id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
    </acl>
    <BLANKLINE>


John cannot see the permissions, though:

    >>> print rest("""
    ... GET /persons/acl HTTP/1.1
    ... """)
    HTTP/1.1 401 Unauthorized
    ...


John can not set the permissions as well:

    >>> print rest("""
    ... POST /persons/acl HTTP/1.1
    ... Authorization: Basic john:ann
    ...
    ... <acl xmlns="http://schooltool.org/ns/model/0.1">
    ...   <principal id="sb.group.a-group">
    ...     <permission id="schooltool.view" />
    ...     <permission id="schooltool.edit" />
    ...     <permission id="schooltool.create" />
    ...     <permission id="schooltool.viewCalendar" />
    ...     <permission id="schooltool.addEvent" />
    ...     <permission id="schooltool.modifyEvent" />
    ...     <permission id="schooltool.controlAccess" />
    ...     <permission id="schooltool.manageMembership" />
    ...   </principal>
    ... </acl>
    ... """)
    HTTP/1.1 401 Unauthorized
    ...


Let's change some permissions and grant John the right to manage
permissions:

    >>> print rest("""
    ... POST /persons/acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ...
    ... <acl xmlns="http://schooltool.org/ns/model/0.1">
    ...   <principal id="sb.group.a-group">
    ...     <permission id="schooltool.view" />
    ...     <permission id="schooltool.edit" />
    ...     <permission id="schooltool.create" />
    ...     <permission id="schooltool.viewCalendar" setting="on" />
    ...     <permission id="schooltool.addEvent" />
    ...     <permission id="schooltool.modifyEvent" />
    ...     <permission id="schooltool.controlAccess" />
    ...     <permission id="schooltool.manageMembership" />
    ...   </principal>
    ...   <principal id="sb.person.john">
    ...     <permission id="schooltool.view" />
    ...     <permission id="schooltool.edit" />
    ...     <permission id="schooltool.create" />
    ...     <permission id="schooltool.viewCalendar" />
    ...     <permission id="schooltool.addEvent" />
    ...     <permission id="schooltool.modifyEvent" />
    ...     <permission id="schooltool.controlAccess" setting="on" />
    ...     <permission id="schooltool.manageMembership" />
    ...   </principal>
    ... </acl>
    ... """)
    HTTP/1.1 200 Ok
    Content-Length: ...
    Set-Cookie: ...
    <BLANKLINE>
    Permissions updated

Now, the permissions are changed and John can see them:

    >>> print rest("""
    ... GET /persons/acl HTTP/1.1
    ... Authorization: Basic john:ann
    ... """)
    HTTP/1.1 200 Ok
    Content-Length: ...
    Content-Type: text/html;charset=utf-8
    Set-Cookie: ...
    ...
    <BLANKLINE>
    <acl xmlns="http://schooltool.org/ns/model/0.1">
      <principal id="zope.Authenticated">
    <BLANKLINE>
          <permission setting="on" id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="zope.Anybody">
    <BLANKLINE>
          <permission id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.group.a-group">
    <BLANKLINE>
          <permission id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission setting="on" id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.group.manager">
    <BLANKLINE>
          <permission id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.person.john">
    <BLANKLINE>
          <permission id="schooltool.view" />
          <permission id="schooltool.edit" />
          <permission id="schooltool.create" />
          <permission id="schooltool.viewCalendar" />
          <permission id="schooltool.addEvent" />
          <permission id="schooltool.modifyEvent" />
          <permission setting="on" id="schooltool.controlAccess" />
          <permission id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
      <principal id="sb.person.manager">
    <BLANKLINE>
          <permission setting="on" id="schooltool.view" />
          <permission setting="on" id="schooltool.edit" />
          <permission setting="on" id="schooltool.create" />
          <permission setting="on" id="schooltool.viewCalendar" />
          <permission setting="on" id="schooltool.addEvent" />
          <permission setting="on" id="schooltool.modifyEvent" />
          <permission setting="on" id="schooltool.controlAccess" />
          <permission setting="on"
                      id="schooltool.manageMembership" />
    <BLANKLINE>
      </principal>
    </acl>
    <BLANKLINE>

And John can modify the permissions:

    >>> print rest("""
    ... POST /persons/acl HTTP/1.1
    ... Authorization: Basic john:ann
    ...
    ... <acl xmlns="http://schooltool.org/ns/model/0.1">
    ...   <principal id="sb.group.a-group">
    ...     <permission id="schooltool.view" />
    ...     <permission id="schooltool.edit" />
    ...     <permission id="schooltool.create" />
    ...     <permission id="schooltool.viewCalendar" />
    ...     <permission id="schooltool.addEvent" />
    ...     <permission id="schooltool.modifyEvent" />
    ...     <permission id="schooltool.controlAccess" />
    ...     <permission id="schooltool.manageMembership" />
    ...   </principal>
    ... </acl>
    ... """)
    HTTP/1.1 200 Ok
    ...
    <BLANKLINE>
    Permissions updated

The ACL views work everywhere:

    >>> print rest("""
    ... GET /acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... """)
    HTTP/1.1 200 Ok
    ...

    >>> print rest("""
    ... GET /persons/acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... """)
    HTTP/1.1 200 Ok
    ...

    >>> print rest("""
    ... GET /groups/acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... """)
    HTTP/1.1 200 Ok
    ...

    >>> print rest("""
    ... GET /groups/a-group/acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... """)
    HTTP/1.1 200 Ok
    ...

    >>> print rest("""
    ... GET /groups/a-group/calendar/acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... """)
    HTTP/1.1 200 Ok
    ...

    >>> print rest("""
    ... GET /persons/john/acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... """)
    HTTP/1.1 200 Ok
    ...

    >>> print rest("""
    ... GET /persons/john/calendar/acl HTTP/1.1
    ... Authorization: Basic manager:schooltool
    ... """)
    HTTP/1.1 200 Ok
    ...

