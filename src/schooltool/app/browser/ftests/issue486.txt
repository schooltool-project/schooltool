Regression test for issue 486
=============================

We have two actors: John and Mary.  John grants Mary permission to add
events to his calendar.  Mary wants to add an event that books a resource.
She should be able to do that without having the edit event permission.


Setup
-----

We need two persons and a resource

    >>> from schooltool.app.browser.ftests import setup
    >>> setup.addPerson('John')
    >>> setup.addPerson('Mary')
    >>> setup.addResource('Teacup')

The manager grants Mary permission to add events to the calendar of Teacup.

    >>> mgr_browser = setup.logInManager()
    >>> mgr_browser.getLink('Resources').click()
    >>> mgr_browser.getLink('Teacup').click()
    >>> mgr_browser.getLink('Set Up Access').click()
    >>> settings = mgr_browser.getControl(name='sb.person.mary')
    >>> settings.value += ['schooltool.addEvent']
    >>> mgr_browser.getControl('Set Access', index=1).click()

John grants Mary permission to add events to his calendar.

    >>> john_browser = setup.logIn('john', 'johnpwd')
    >>> john_browser.getLink('John').click()
    >>> john_browser.getLink('Set Up Access').click()
    >>> john_browser.url
    'http://localhost/persons/john/@@acl.html'

    >>> settings = john_browser.getControl(name='sb.person.mary')
    >>> settings.value += ['schooltool.viewCalendar', 'schooltool.addEvent']
    >>> john_browser.getControl('Set Access', index=1).click()

Mary logs in and finds John's calendar

    >>> mary_browser = setup.logIn('mary', 'marypwd')
    >>> mary_browser.getLink('persons').click()
    >>> mary_browser.getLink('John').click()
    >>> mary_browser.getLink('View Calendar').click()

Mary tries to add an event that books a resource

    >>> mary_browser.getLink('New Event').click()
    >>> mary_browser.getControl('Title').value = 'Tea'
    >>> mary_browser.getControl('Date').value = '2006-05-10'
    >>> mary_browser.getControl('Time').value = '17:00'
    >>> mary_browser.getControl('Duration').value = '60'
    >>> mary_browser.getControl('Book Resources').click()
    >>> mary_browser.getControl('Add').click()
    >>> mary_browser.getControl('Teacup').click()
    >>> mary_browser.getControl('Book').click()
    >>> mary_browser.url
    'http://localhost/persons/john/calendar'

Mary cannot change that event because she doesn't have the modifyEvent
permission

    >>> mary_browser.open('http://localhost/persons/john/calendar/2006-05-10')
    >>> mary_browser.getLink('Tea').click()

    >>> mary_browser.handleErrors = True
    >>> mary_browser.getLink('edit resources').click()
    >>> 'login' in mary_browser.url
    True

