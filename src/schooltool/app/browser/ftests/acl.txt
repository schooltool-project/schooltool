Access control view
===================

First, create a SchoolBell instance:

    >>> from testbrowser import Browser
    >>> manager = Browser()
    >>> manager.addHeader('Authorization', 'Basic mgr:mgrpw')
    >>> manager.handleErrors = False
    >>> manager.open('http://localhost/contents.html')

    >>> manager.getLink('SchoolTool').click()
    >>> manager.getControl(name='new_value').value = 'frogpond'
    >>> manager.getControl('Apply').click()

    >>> 'frogpond' in manager.contents
    True

Let's create a person so that we can fool around with his calendar:

    >>> manager.getLink('frogpond').click()
    >>> manager.getLink('Persons').click()
    >>> manager.getLink('New Person').click()

    >>> manager.getControl('Full name').value = 'Frog'
    >>> manager.getControl('Username').value = 'frog'
    >>> manager.getControl('Password').value = 'pwd'
    >>> manager.getControl('Verify password').value = 'pwd'
    >>> manager.getControl('Add').click()

    >>> 'Frog' in manager.contents
    True

After logging in the frog

    >>> frog = Browser()
    >>> frog.open('http://localhost/frogpond/')
    >>> frog.getLink('Log In').click()
    >>> frog.getControl('Username').value = 'frog'
    >>> frog.getControl('Password').value = 'pwd'
    >>> frog.getControl('Log in').click()

he can't access the ACL view:

    >>> frog.open('http://localhost/frogpond/acl.html')
    >>> print frog.url
    http://localhost/frogpond/@@login.html?forbidden=yes&nexturl=...

Grant him a 'schooltool.controlAccess' permission on the app:

    >>> manager.open('http://localhost/frogpond/acl.html')
    >>> ctrl = manager.getControl(name='sb.person.frog')
    >>> ctrl.value = ['schooltool.controlAccess', 'schooltool.view']
    >>> manager.getControl('Set Access', index=1).click()

Now he can access the acl.html view on app:

    >>> frog.open('http://localhost/frogpond/acl.html')
    >>> 'Access control for SchoolTool' in frog.contents
    True

Also, he can set the permissions, even elevate his own permissions:

    >>> ctrl = frog.getControl(name='sb.person.frog')
    >>> ctrl.value = ['schooltool.view', 'schooltool.edit',
    ...               'schooltool.addEvent', 'schooltool.modifyEvent',
    ...               'schooltool.controlAccess', 'schooltool.create']
    >>> frog.getControl('Set Access', index=1).click()

It works for subobjects of the app too:

    >>> frog.open('http://localhost/frogpond/persons/acl.html')
    >>> ctrl = frog.getControl(name='sb.person.frog')
    >>> ctrl.value = ['schooltool.view', 'schooltool.edit',
    ...               'schooltool.addEvent', 'schooltool.modifyEvent',
    ...               'schooltool.controlAccess', 'schooltool.create']
    >>> frog.getControl('Set Access', index=1).click()
