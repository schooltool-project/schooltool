Access control view
===================

First, log in

    >>> from zope.testbrowser.testing import Browser
    >>> manager = Browser()
    >>> manager.handleErrors = False
    >>> manager.addHeader('Authorization', 'Basic manager:schooltool')
    >>> manager.open('http://localhost/')
    >>> 'SchoolTool' in manager.contents
    True

Let's create a person so that we can fool around with his calendar:

    >>> from schooltool.app.browser.ftests.setup import addPerson
    >>> addPerson('Frog', 'frog', 'pwd')

After logging in the frog

    >>> frog = Browser()
    >>> frog.open('http://localhost/')
    >>> frog.getLink('Log In').click()
    >>> frog.getControl('Username').value = 'frog'
    >>> frog.getControl('Password').value = 'pwd'
    >>> frog.getControl('Log in').click()

he can't access the ACL view:

    >>> frog.open('http://localhost/acl.html')
    >>> print frog.url
    http://localhost/@@login.html?forbidden=yes&nexturl=...

Grant him a 'schooltool.controlAccess' permission on the app:

    >>> manager.open('http://localhost/acl.html')
    >>> ctrl = manager.getControl(name='sb.person.frog')
    >>> ctrl.value = ['schooltool.controlAccess', 'schooltool.view']
    >>> manager.getControl('Set Access', index=1).click()

Now he can access the acl.html view on app:

    >>> frog.open('http://localhost/acl.html')
    >>> 'Access control for SchoolTool' in frog.contents
    True

Also, he can set the permissions, even elevate his own permissions:

    >>> ctrl = frog.getControl(name='sb.person.frog')
    >>> ctrl.value = ['schooltool.view', 'schooltool.edit',
    ...               'schooltool.addEvent', 'schooltool.modifyEvent',
    ...               'schooltool.controlAccess', 'schooltool.create']
    >>> frog.getControl('Set Access', index=1).click()

It works for subobjects of the app too:

    >>> frog.open('http://localhost/persons/acl.html')
    >>> ctrl = frog.getControl(name='sb.person.frog')
    >>> ctrl.value = ['schooltool.view', 'schooltool.edit',
    ...               'schooltool.addEvent', 'schooltool.modifyEvent',
    ...               'schooltool.controlAccess', 'schooltool.create']
    >>> frog.getControl('Set Access', index=1).click()
