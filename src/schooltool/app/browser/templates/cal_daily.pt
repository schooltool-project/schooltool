<tal:defs define="ignored_status view/update" />
<html metal:use-macro="view/@@schooltool_macros/calendar/page" 
      i18n:domain="schoolbell">
<metal:block fill-slot="calendar-body">

<div id="events-allday">
  <tal:loop repeat="allday view/getAllDayEvents">
    <div class="event-allday"
         tal:attributes="style string:border: 1px ${allday/color2} solid;;
                         background: ${allday/color1};;">
      <h6>
        <a tal:attributes="href allday/viewLink; title allday/description"
           tal:content="allday/title">(title)</a>
      </h6>
      <tal:comment>
        XXX mg: I suspect that
                  i18n:attributes="title"
                  tal:attributes="title string:Delete $foo"
                will not work, as it might try to translate all the real titles
                (such as "Delete Meeting With Friend"), which will never be
                defined in the '.po' file.
            Watch out for more occurrences of this potential problem.
      </tal:comment>
      <a class="delete"
         i18n:attributes="title"
         tal:attributes="href allday/deleteLink;
                         title string:Delete ${allday/title}"
        ><img alt="[X]"
              tal:attributes="src context/++resource++delete.png" /></a>
      <p tal:condition="allday/description"
         tal:content="allday/description">
        (description)
      </p>
    </div>
  </tal:loop>
</div>

<div id="calendar-view-day"
     tal:define="height python:4;
                 hours python:list(view.getHours());
                 dayheight python: len(hours) * height;"
     tal:attributes="style string:height: ${dayheight}em">

<!-- Day grid -->
<tal:loop repeat="hour hours">
  <tal:block tal:define="num repeat/hour/index">
    <div class="hour"
         tal:condition="view/canAddEvents"
         tal:attributes="onclick string:parent.location='${context/@@absolute_url}/add.html?field.start_date=${view/cursor}&amp;field.start_time=${hour/time}&amp;field.duration=${hour/duration}';
                         style string:top: ${hour/top}em;; height: ${hour/height}em;; cursor: pointer;
                         class string:hour ${repeat/hour/parity}">
      <a class="event-new" style="width:100%; height:100%;" title=""
         i18n:attributes="title"
         tal:attributes="href string:${context/@@absolute_url}/add.html?field.start_date=${view/cursor}&amp;field.start_time=${hour/time}&amp;field.duration=${hour/duration};
                         title string:Add new event starting at ${hour/title}"
         tal:content="hour/title">HH:MM</a>
    </div>
    <div class="hour"
         tal:condition="not:view/canAddEvents"
         tal:attributes="style string:top: ${hour/top}em;; height: ${hour/height}em;
                         class string:hour ${repeat/hour/parity}">
      <span class="event-new" style="width:100%; height:100%;" title=""
         i18n:attributes="title"
         tal:content="hour/title">HH:MM</span>
    </div>
  </tal:block>
</tal:loop>

<!-- Events -->
<div class="events" tal:define="compress python:view.getColumns() > 2">
  <tal:loop repeat="hour hours">
    <tal:block define="num repeat/hour/index; top python:num * height"
               repeat="ev hour/cols">
      <tal:if condition="ev">
        <div class="event"
             onmouseover="this.style.zIndex=9; this.style.overflow='visible'; this.style.display='block';"
             onmouseout="this.style.zIndex=1; this.style.overflow='hidden'; this.style.display='block';"
             tal:define="num repeat/ev/index;
                         unit python:compress and '%' or 'em';
                         indent python:compress and 15 or 20.5;
                         left python:num * indent;
                         top python:view.eventTop(ev);
                         height python:view.eventHeight(ev);
                         evdate python:ev.dtstart.strftime('%Y-%m-%d');
                         mine python:True or ev.owner==request.authenticated_user"
             tal:attributes="style string:background: ${ev/color1};;
                             min-height: ${height}em;;
                             height: ${height}em;;
                             margin-left: $left$unit;;
                             top: ${top}em;
                             class python:mine and 'event' or 'event other'">

          <h6 tal:attributes="style string:background: ${ev/color2}">
            <a tal:attributes="href ev/viewLink; title ev/title"
               tal:omit-tag="not:ev/viewLink">
              <span tal:replace="ev/shortTitle">(shortened title)</span>
              <span class="start-end">
                (<span
                   tal:content="python:ev.dtstarttz.strftime(view.time_fmt)"/>
                   -
                 <span
                   tal:content="python:ev.dtendtz.strftime(view.time_fmt)"/>)
              </span>
            </a>
          </h6>
          <tal:if_can_remove_events condition="view/canRemoveEvents">
            <a class="delete"
               tal:condition="ev/deleteLink"
               i18n:attributes="title"
               tal:attributes="href ev/deleteLink;
                               title string:Delete ${ev/title}"
              ><img alt="[X]"
                    tal:attributes="src context/++resource++delete.png" /></a>
          </tal:if_can_remove_events>

          <div class="body"
               tal:attributes="style string:background: ${ev/color1};">
            <div class="title"
                 tal:condition="python: ev.title != ev.shortTitle"
                 tal:content="ev/title">
              (title, but only if it was shortened in the title bar)
            </div>
            <div i18n:translate="" tal:condition="ev/location"
                 class="location">Location:
              <span tal:content="ev/location" i18n:name="location" />
            </div>
            <div class="description" tal:content="ev/description" />
          </div>

          <div class="booked-resources"
               tal:define="resources ev/getBookedResources"
               tal:condition="resources">
            <h6 class="booked-resource-header"
                tal:attributes="style string:background: ${ev/color2}">
              <a style="color: #000;"
                 tal:attributes="href ev/bookingLink">Booked resources</a></h6>
            <tal:block tal:repeat="resource resources">
              <a tal:attributes="href resource/@@absolute_url"
                 tal:content="resource/title">(A Pond)</a>
            </tal:block>
          </div>
          <div class="booked-resources"
               tal:define="booker ev/getBooker"
               tal:condition="booker">
            <h6 class="booked-resource-header"
                tal:attributes="style string:background: ${ev/color2}">
              <a style="color: #000;"
                 tal:attributes="href ev/bookingLink">Booked by</a></h6>
            <a tal:attributes="href booker/@@absolute_url"
               tal:content="booker/title">(A Dude)</a>
          </div>
        </div>
      </tal:if>
    </tal:block>
  </tal:loop>
</div>

</div>
</metal:block>
</html>
