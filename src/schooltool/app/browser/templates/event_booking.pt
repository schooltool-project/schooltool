<tal:defs define="dummy view/update" />
<html metal:use-macro="view/@@standard_macros/page" i18n:domain="schooltool">
<head>
  <title metal:fill-slot="title" i18n:translate="">Resource Booking</title>
</head>
<body>
<metal:block metal:fill-slot="body"
            tal:define="batch view/batch">

<form tal:attributes="action request/URL" method="post" class="standalone booking_form">
  <h3 i18n:translate="">
    Resource Booking for <span i18n:name="title"
                               tal:replace="context/title">something</span>
  </h3>

  <fieldset>
    <div>
      <strong i18n:translate="">Title:</strong>
      <span tal:replace="context/title">not_doe</span>
    </div>
    <div>
      <strong i18n:translate="">Starts:</strong>
      <span tal:replace="view/start"/>
    </div>
    <div>
      <strong i18n:translate="">Ends:</strong>
      <span tal:replace="view/end"/>
    </div>
    <div tal:condition="context/recurrence">
      <strong i18n:translate="">This is a recurring event!</strong>
    </div>
  </fieldset>

  <input type="hidden" tal:condition="request/date|nothing"
         name="date" tal:attributes="value request/date" />
    <!-- tal:block content="view/renderUnavailableResourceTable" / FIX ME -->

    <fieldset tal:condition="view/hasBookedItems">
      <legend i18n:translate="">Booked resources</legend>

      <tal:block replace="structure view/renderBookedTable" />
        <div class="controls">
          <input type="submit" class="button-ok" name="UNBOOK"
                 value="UnBook"
                 title="Shortcut: Alt-A" accesskey="A"
                 i18n:attributes="value; accesskey" />
        </div>

    </fieldset>

    <fieldset>
      <legend i18n:translate="">Available resources</legend>
      <div class="item_list">
        <tal:if tal:condition="batch">
          <tal:if condition="view/filter_widget/active">
            <tal:block define="extra_url view/filter_widget/extra_url">
              <div metal:use-macro="view/@@batch_macros/batch-navigation"/>
            </tal:block>
          </tal:if>
          <tal:if condition="not:view/filter_widget/active">
            <div metal:use-macro="view/@@batch_macros/batch-navigation"/>
          </tal:if>
        </tal:if>
        <tal:block replace="structure view/filter_widget/render" />
        <tal:block replace="structure view/renderAvailableTable" />
        <div class="controls">
          <input type="submit" class="button-ok" name="BOOK"
                 value="Book" tal:condition="batch"
                 title="Shortcut: Alt-A" accesskey="A"
                 i18n:attributes="value; accesskey" />
          <input type="submit" class="button-cancel" name="CANCEL"
                 value="Cancel"
                 title="Shortcut: Alt-C" accesskey="C"
                 i18n:attributes="value; accesskey" />

        </div>
        <p tal:condition="not:batch" i18n:translate="">
          There are none to add.
        </p>
      </div>
    </fieldset>

    <table class="event_booking">
      <tal:block tal:repeat="resource view/availableResources/sortby:title">
        <tr tal:attributes="class repeat/resource/parity">
          <!-- td class="booked">
            <input type="checkbox"
                   value="booked"
                   tal:attributes="name resource/zope:name;
                                   id resource/zope:name;
                                   checked python: view.hasBooked(resource)" />
          </td>
          <th class="resource">
            <label tal:attributes="for resource/zope:name" tal:content="resource/title">Resource foo</label>
            <input type="hidden" tal:attributes="name string:marker-${resource/zope:name}"
                   value="1" />
          </th -->
          <td tal:define="conflicting_events python:view.getConflictingEvents(resource)"
              tal:condition="conflicting_events">
            <fieldset style="text-align: left;">
              <legend i18n:translate="">Conflicting events</legend>
              <div>
                <div tal:repeat="event conflicting_events">
                  <tal:if condition="event/context/__parent__">
                    <a tal:attributes="href string:${event/context/@@absolute_url}/edit.html" tal:content="event/shortTitle" />
                  </tal:if>
                  <tal:if condition="not:event/context/__parent__">
                    <a tal:attributes="href string:${event/context/activity/owner/@@absolute_url}/resources.html" tal:content="event/shortTitle" />
                  </tal:if>
                    (<span tal:replace="python:event.dtstart.strftime('%H:%M')"/> -
                    <span tal:replace="python:event.dtend.strftime('%H:%M')"/>)
                    <tal:block tal:define="owner python: event.context.__parent__
                                                           and event.context.__parent__.__parent__
                                                           or event.context.activity.owner">
                      <a tal:define="owner_url string:${owner/@@absolute_url}/calendar"
                         tal:attributes="href python: '%s/%s/' % (owner_url, context.dtstart.strftime('%Y-%m-%d'))" tal:content="owner/title">A Dude</a>
                    </tal:block>
                </div>
              </div>
            </fieldset>
          </td>
        </tr>
      </tal:block>
    </table>

</form>
</metal:block>
</body>
</html>
