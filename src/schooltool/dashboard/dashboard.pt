<tal:block i18n:domain="schooltool">
<script type="text/javascript" tal:content="view/dynamicVariables">
</script>

<script type="text/javascript">
  maxHeight = 75; //height it should go to in percent
  opened = false;
  moving = false;
  written = false;
  function mouseDaemon(url){
    if (opened == false && moving == false){
      if (written == false){
        document.getElementById('dashboardContents').innerHTML = 'loading...'
        getDashboardContent();
        written = true;
      }
      moving = true;
      openDash();
      opened = true;
    }
    else if (moving == false){
      moving = true;
      closeDash();
      opened = false;
    }
  }
  function openDash(){
    tab = $('dashboardTab').style;
    content = $('dashboardContents').style;
    content.display = '';
    if (parseInt(content.height) < maxHeight){
      content.height = parseInt(content.height)+10+'%';
      tab.bottom = parseInt(tab.bottom)+10+'%';
      blah = setTimeout("openDash();",20);
    }
    else moving = false;
  }
  function closeDash(){
    tab = $('dashboardTab').style;
    content = $('dashboardContents').style;
    content.display = '';
    if (parseInt(content.height) > 0){
      content.height = parseInt(content.height)-10+'%';
      tab.bottom = parseInt(tab.bottom)-10+'%';
      blah = setTimeout("closeDash();",20);
    }
    else {content.display = 'none'; moving = false; }
  }

  function getDashboardContent(){
    deferred = doSimpleXMLHttpRequest(ajaxURL);
    deferred.addCallback(alertContents);
  }

  function alertContents(http_request) {
    $('dashboardContents').innerHTML = http_request.responseText;
  }
</script>

<style type="text/css">
  .dashboardButton {
    position: fixed;
    width: 20%;
    right: 40%;
    background: #EAE8E3;
    text-align: center;
    font-weight: bold;
    z-index: 99;
    border: solid 0px #000;
    border-bottom: 0px;
  }
  div .dashboardContents {
    position: fixed;
    bottom: 0px;
    width: 80%;
    right: 10%;
    background: #fff;
    background: #EAE8E3;
    text-align: center;
    z-index: 98;
    border: solid 1px #BAB5AB;
    border-bottom: 0px;
    overflow: auto;
    text-align: left;
  }
</style>

<a style="bottom: 0px;" class="dashboardButton" tal:attributes="href string:${context/schooltool:app/@@absolute_url}/@@dashboard.html"
   i18n:translate=""
   id="dashboardTab">Dashboard</a>
<div id="dashboardContents" class="dashboardContents"
     style="height: 0%; display: none;">
</div>
<script type="text/javascript">
$('dashboardTab').href="javascript:mouseDaemon()";
roundElement($('dashboardTab'), {corners: "top", border: "#BAB5AB"});
</script>
</tal:block>
