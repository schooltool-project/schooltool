<html metal:use-macro="view/@@standard_macros/page" i18n:domain="schooltool">
<head>
  <title metal:fill-slot="title" i18n:translate="">
    Scheduling for <span i18n:name="person" tal:replace="context/title" />
  </title>
</head>
<body>

<h1 metal:fill-slot="content-header" i18n:translate="">
  Scheduling for <span i18n:name="person" tal:replace="context/title" />
</h1>

<metal:block metal:fill-slot="body">

<p tal:condition="not:view/has_timetables"
   i18n:translate="">There are no terms or timetable schemas defined.</p>

<tal:if tal:condition="view/has_timetables">
<form tal:attributes="action request/URL" class="plain" method="post">

  <fieldset>
    <legend i18n:translate="">Timetable</legend>

    <label for="term" i18n:translate="">Term</label>
    <select id="term" name="term"
            tal:define="terms view/terms/values">
      <option tal:repeat="term terms/sortby:first"
              tal:attributes="value term/__name__;
                              selected python:term is view.term
                                          and 'selected' or None"
              tal:content="term/title"></option>
    </select>

    <label for="ttschema" i18n:translate="">Schema</label>
    <select id="ttschema" name="ttschema"
            tal:define="ttschemas view/ttschemas/values">
      <option tal:repeat="ttschema ttschemas/sortby:__name__"
              tal:attributes="value ttschema/__name__;
                              selected python:ttschema is view.ttschema
                                          and 'selected' or None"
              tal:content="ttschema/__name__"></option>
    </select>
    <input class="button-ok" type="submit" name="REFRESH" value="Choose"
           i18n:attributes="value" />
  </fieldset>
</form>

<form tal:attributes="action request/URL" class="plain" method="post">

  <input type="hidden" name="term" tal:attributes="value view/term/__name__" />
  <input type="hidden" name="ttschema"
         tal:attributes="value view/ttschema/__name__" />

  <p i18n:translate="">
  This form lets you set up the timetable of a person by adding and removing
  the person to and from sections that have classes in their timetables.
  </p>

  <tal:block repeat="day view/days">
    <h2 tal:content="day/title">Day N</h2>

    <table class="timetable_setup">
      <tal:block tal:repeat="period day/periods">
        <tr tal:define="conflict python: len(period['selected']) > 1 or len(period['in_group']) > 1  "
          tal:attributes="class python: conflict and 'conflict' or ''">
        <th tal:content="period/title">Period N</th>
        <td tal:condition="period/in_group"
            tal:repeat="in_group period/in_group">
          <a href=""
             tal:attributes="href in_group/section/@@absolute_url"
             tal:content="in_group/section/title" />
          <span class="hint">
            <span i18n:translate="">as part of</span>
            <a href=""
               tal:attributes="href in_group/group/@@absolute_url"
               tal:content="in_group/group/title" />
          </span>
        </td>
        <td tal:condition="not:period/in_group"
            tal:repeat="selection period/selected">
          <select name="sections:list">
            <option value=""
                    tal:attributes="selected python:selection is None
                                                and 'selected' or None"
                    i18n:translate="">none</option>
            <option tal:repeat="section period/sections/sortby:title"
                    tal:attributes="value section/__name__;
                        selected python:(selection and section.__name__ == selection.__name__)
                                        and 'selected' or None"
                    tal:content="section/label"></option>
          </select>
        </td>
        <td class="conflict" tal:condition="conflict" i18n:translate="">
        Scheduling conflict.
        </td>
      </tr>
      </tal:block>
    </table>
  </tal:block>

  <p i18n:translate="">
  Note: if a section appears in more than one slot, all of them have
  to be set to <em>none</em> to remove it.
  </p>

  <div class="controls">
    <input class="button-ok" type="submit" name="SAVE" value="Save"
           i18n:attributes="value" />
  </div>

</form>
</tal:if>

</metal:block>
</body>
</html>
