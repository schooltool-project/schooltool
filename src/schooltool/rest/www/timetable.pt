<timetable xmlns="http://schooltool.org/ns/timetable/0.1"
           xmlns:xlink="http://www.w3.org/1999/xlink"
           xmlns:tal="http://xml.zope.org/namespaces/tal"
           xmlns:metal="http://xml.zope.org/namespaces/metal">
  <day tal:repeat="item context/items"
       tal:attributes="id python:item[0]">
    <period tal:define="day python:item[1]"
            tal:repeat="item day/items"
            tal:attributes="id python:item[0]">
     <tal:block tal:repeat="activity python:item[1]">
      <activity metal:define-macro="activity"
                tal:attributes="title activity/title">
        <resource tal:repeat="resource activity/resources"
                  xlink:type="simple"
                  tal:attributes="xlink:title resource/title;
                          xlink:href python:view.absolutePath(resource)" />
      </activity>
     </tal:block>
    </period>
  </day>
  <exception tal:repeat="exc context/exceptions"
             tal:attributes="date python:exc.date.strftime('%Y-%m-%d');
                             period exc/period_id">
   <tal:block tal:define="activity exc/activity">
    <activity metal:use-macro="template/macros/activity" />
   </tal:block>
    <replacement tal:define="event exc/replacement" tal:condition="event"
                 tal:attributes="date python:event.dtstart.strftime('%Y-%m-%d');
                                 time python:event.dtstart.strftime('%H:%M');
                                 duration python:event.duration.seconds / 60"
                 tal:content="exc/replacement/title"/>
  </exception>
</timetable>
