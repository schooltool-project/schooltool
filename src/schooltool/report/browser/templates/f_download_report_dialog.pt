<div i18n:domain="schooltool">
  <table>
    <tbody>
      <tr>
        <td>
          <tal:block condition="nocall:context/report">
            <tal:block i18n:translate="">
              Generated
            </tal:block>
            <a tal:attributes="href context/report/@@absolute_url"
               tal:content="context/filename"/>
          </tal:block>
          <tal:block condition="not:nocall:context/report">
            <tal:block content="context/title" />
          </tal:block>
        </td>
      </tr>
      <tal:block condition="not:view/failure_ticket_id">
        <tr tal:condition="view/main_recipient">
          <td i18n:translate="">
            You can download this report at a later time from
            <a tal:attributes="href view/main_recipient/@@absolute_url"
               i18n:name="home-link" i18n:translate="">home page</a>.
          </td>
        </tr>
      </tal:block>
      <tal:block condition="view/failure_ticket_id">
        <tr>
          <td>
            <p i18n:translate="">
              <span class="error">Sytem failure.</span>  Ticket nr.
              <span i18n:name="ticket_id" tal:content="view/failure_ticket_id" />.
            </p>
            <p i18n:translate="">
              Please contact your administrator.
            </p>
          </td>
        </tr>
      </tal:block>
    </tbody>
  </table>
  <form method="post" class="standalone" action=""
        tal:attributes="action view/@@absolute_url;
                        id view/form_id">

    <div class="buttons">
    <tal:block condition="not:nocall:context/report">
      <input class="button-ok" name="REFRESH" onclick="return ST.dialogs.submit(this, this);" value="Refresh" type="submit" i18n:attributes="value">
    </tal:block>
      <input class="button-cancel" name="CANCEL" onclick="return ST.dialogs.close(this);" value="Close" type="submit" i18n:attributes="value">
    </div>
  </form>

  <script>ST.state.push()</script>
  <tal:script
      tal:replace="structure scriptlocal:delay view/refresh_delay;
                                         form_id view/form_id;
                                         generated view/report_generated" />
  <script>
    if (!generated) {
        var form = $(ST.dialogs.jquery_id(ST.local.form_id));
        setTimeout(function(){ST.dialogs.submit(form);}, ST.local.delay);
    }
  </script>
  <script>ST.state.pop()</script>
</div>
