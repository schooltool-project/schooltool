<html metal:use-macro="view/macros/page" i18n:domain="schooltool">
<head>
  <title metal:fill-slot="title" tal:content="view/title">Timetable</title>
</head>
<body>
  <h1 metal:fill-slot="h1" tal:content="view/title">Timetable</h1>
<metal:block metal:fill-slot="content"
             tal:define="owner_url context/__parent__/__parent__/@@absolute_url;
                         calendar_url string:$owner_url/calendar/daily.html;
                         can_edit view/canEdit">

  <table class="timetable"
         tal:define="ncols python:len(context.day_ids) or 1;
                     col_width python:'%d%%' % (100 / ncols);
                     th_width python: '%d%%' % (10 / ncols);
                     td_width python: '%d%%' % (90 / ncols)">
    <tr>
      <th tal:repeat="day context/day_ids" tal:content="day"
          tal:attributes="width col_width" colspan="2" class="day">Day N</th>
    </tr>
    <tr tal:repeat="row view/rows"><tal:block tal:repeat="col row">
      <th tal:attributes="width th_width" tal:content="col/period"
          class="period">1</th>
      <td tal:attributes="width td_width" tal:content="col/activity"
          class="activity">Act1</td>
    </tal:block></tr>
  </table>

<tal:if condition="context/exceptions">
  <h2 i18n:translate="">Timetable exceptions</h2>

  <form tal:omit-tag="not:can_edit"
        tal:attributes="action request/uri"
        class="invisible"
        method="POST">

  <ul>
    <li tal:repeat="exc context/exceptions">
      <span tal:condition="not:exc/replacement" i18n:translate="">
        On <a tal:define="date python:exc.date.strftime('%Y-%m-%d')"
        tal:content="date" tal:attributes="href string:$calendar_url?date=$date"
        i18n:name="date" />, period <span tal:replace="exc/period_id"
        i18n:name="period" />, <span tal:replace="exc/activity/title"
        i18n:name="activity" /> is canceled.
      </span>
      <span tal:define="ev exc/replacement"
            tal:condition="python: ev and ev.dtstart.date() == exc.date"
            i18n:translate="">
        On <a tal:define="date python:exc.date.strftime('%Y-%m-%d')"
        tal:content="date" tal:attributes="href string:$calendar_url?date=$date"
        i18n:name="date" />, period <span tal:replace="exc/period_id"
        i18n:name="period" />, <span tal:replace="exc/activity/title"
        i18n:name="activity" /> is replaced with <span tal:replace="ev/title"
        i18n:name="title" />
        from <span tal:replace="python: ev.dtstart.strftime('%H:%M')"
        i18n:name="start" /> to <span tal:define="dtend python:ev.dtstart +
        ev.duration" tal:replace="python: dtend.strftime('%H:%M')"
        i18n:name="end" />.
      </span>
      <span tal:define="ev exc/replacement"
            tal:condition="python: ev and ev.dtstart.date() != exc.date"
            i18n:translate="">
        On <a tal:define="date python:exc.date.strftime('%Y-%m-%d')"
        tal:content="date" tal:attributes="href string:$calendar_url?date=$date"
        i18n:name="date" />, period <span tal:replace="exc/period_id"
        i18n:name="period" />, <span tal:replace="exc/activity/title"
        i18n:name="activity" /> is replaced with <span tal:replace="ev/title"
        i18n:name="title" />
        from <span tal:replace="python: ev.dtstart.strftime('%H:%M')"
        i18n:name="start" /> to <span tal:define="dtend python:ev.dtstart +
        ev.duration" tal:replace="python: dtend.strftime('%H:%M')"
        i18n:name="end" /> on <a tal:define="date python:ev.dtstart.strftime('%Y-%m-%d')"
        tal:content="date" tal:attributes="href string:$calendar_url?date=$date"
        i18n:name="new_date" />.
      </span>
      <div class="buttons" tal:condition="can_edit">
        <input type="submit" class="button" value="Remove this exception"
               tal:attributes="name string:REMOVE.${repeat/exc/number}"
               i18n:attributes="value" />
      </div>
    </li>
  </ul>

  </form>

  <p tal:condition="can_edit" i18n:translate="">To add a timetable exception,
  just edit or delete a timetable event in the <span i18n:name="calendar">
  <a tal:attributes="href calendar_url" i18n:translate="">calendar</a></span>.
  </p>
</tal:if>

</metal:block>
</body>
</html>
