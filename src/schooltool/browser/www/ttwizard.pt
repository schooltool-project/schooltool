<html metal:use-macro="view/macros/page" i18n:domain="schooltool">
<head>
  <title metal:fill-slot="title" i18n:translate="">New timetable schema</title>
</head>
<body>
  <h1 metal:fill-slot="h1" i18n:translate="">New timetable schema</h1>
<metal:block metal:fill-slot="content">

<form class="invisible" method="POST" tal:attributes="action request/uri"
      tal:define="tt view/ttschema;
                  ncols python:len(tt.day_ids) or 1;
                  rows view/rows;
                  nrows python:len(rows);
                  period_times view/period_times;
                  nperiods python:len(period_times)">

<div class="form">
  <div class="error" tal:condition="view/name_error"
       tal:content="view/name_error">
    Error.
  </div>
  <label for="name" i18n:translate="">Name</label>
  <input class="text" type="text" name="name" id="name"
         tal:attributes="value view/name" />
</div>

<p i18n:translate="">
First, please define the days and periods of the timetable.
</p>

<div class="form">

  <table class="timetable"
         tal:define="col_width python:'%d%%' % (100 / ncols);
                     tabindex python:ncols*3">
    <tr><tal:block repeat="day tt/day_ids">
      <th class="day">
        <input class="text" type="text" tal:define="n repeat/day/number"
               tal:attributes="name string:day$n; value day;
                               tabindex python:n*3-2" />
      </th>
      <th class="day" width="1%">
        <input class="button" type="submit" tal:define="n repeat/day/number"
               tal:attributes="name string:COPY_DAY_$n;
                               tabindex python:n*3-1"
               value="C" title="Copy periods from previous day"
               i18n:attributes="value; title" />
      </th>
      <th class="day" width="1%">
        <input class="button" type="submit" tal:define="n repeat/day/number"
               tal:attributes="name string:DELETE_DAY_$n;
                               tabindex python:n*3"
               value="X" title="Remove this day"
               i18n:attributes="value; title" />
      </th>
    </tal:block></tr>
    <tr tal:repeat="row rows"><tal:block define="row_n repeat/row/number"
                                         repeat="col row">
      <td class="period" tal:define="col_n repeat/col/number" colspan="3"
          tal:attributes="width col_width">
        <input type="text" class="text"
               tal:attributes="name string:day${col_n}.period${row_n};
                               tabindex python:tabindex+(col_n-1)*nrows+row_n;
                               value col/period" />
      </td>
    </tal:block></tr>
  </table>

  <div class="buttons" tal:define="tabindex python:ncols*(nrows+3)">
    <input type="submit" class="button" name="UPDATE" value="Update"
           tal:attributes="tabindex python:tabindex+1"
           i18n:attributes="value" />
    <input type="submit" class="button" name="ADD_DAY" value="Add day"
           tal:attributes="tabindex python:tabindex+2"
           i18n:attributes="value" />
    <input type="submit" class="button" name="ADD_PERIOD" value="Add period"
           tal:attributes="tabindex python:tabindex+3"
           i18n:attributes="value" />
  </div>

</div>

<p i18n:translate="">
Second, select the way timetable days are aligned with calendar days.
</p>

<div class="form" tal:define="tabindex python:ncols*(nrows+3)+10">
  <div class="error" tal:condition="view/model_error"
       tal:content="view/model_error">
    Error.
  </div>
  <table>
    <tr>
      <td>
        <input id="weekly_model" type="radio" name="model"
               tal:attributes="checked
                      python:view.model_name == 'WeeklyTimetableModel';
                      tabindex python:tabindex+1"
               value="WeeklyTimetableModel" />
      </td>
      <td>
        <label class="block" for="weekly_model" i18n:translate="">
          Timetable day always coincides with the day of week (i.e. on Mondays
          the first timetable day is used, on Tuesdays the second, and so on).
        </label>
      </td>
    </tr>
    <tr>
      <td>
        <input id="sequential_model" type="radio" name="model"
               tal:attributes="checked
                      python:view.model_name == 'SequentialDaysTimetableModel';
                      tabindex python:tabindex+1"
               value="SequentialDaysTimetableModel" />
      </td>
      <td>
        <label class="block" for="sequential_model" i18n:translate="">
          Timetable days are used sequentially, jumping over days that are not
          school days.
        </label>
      </td>
</div>

<p i18n:translate="">
Third, define the time and duration of periods when they fall on certain
days of week.  Use the following format: <tt>HH:MM-HH:MM</tt> (e.g.,
9:30-10:15).  It is not necessary to define all periods for all days of week,
omissions will just cause that period to be skipped if it happens to fall on
that day of week.  If the list of periods is not up to date with the changes
you made in the table above, use the Update button to refresh the form.
</p>

<div class="form" tal:define="tabindex python:ncols*(nrows+3)+20">
  <table class="timetable">
    <tr>
      <th class="day"></th>
      <th class="day" width="12%" i18n:translate="">Monday</th>
      <th class="day" width="12%" i18n:translate="">Tuesday</th>
      <th class="day" width="12%" i18n:translate="">Wednesday</th>
      <th class="day" width="12%" i18n:translate="">Thursday</th>
      <th class="day" width="12%" i18n:translate="">Friday</th>
      <th class="day" width="12%" i18n:translate="">Saturday</th>
      <th class="day" width="12%" i18n:translate="">Sunday</th>
    </tr>
    <tr tal:repeat="period period_times"><tal:block
        define="n repeat/period/number">
      <th class="period" nowrap="">
        <span tal:replace="period/title">Period 1</span>
        <input type="hidden"
               tal:attributes="name string:time$n.period;
                               value period/title" />
      </th>
      <td class="time" tal:repeat="time period/times">
        <input class="text" type="text"
               tal:define="day repeat/time/index"
               tal:attributes="tabindex python:tabindex+day*nperiods+n;
                               name string:time$n.day$day;
                               value time" />
      </td>
    </tal:block></tr>
  </table>

  <div class="buttons"
       tal:define="tabindex python:ncols*(nrows+3)+7*nperiods+30">
    <input type="submit" class="button" name="UPDATE" value="Update"
           tal:attributes="tabindex python:tabindex"
           i18n:attributes="value" />
  </div>
</div>

<p i18n:translate="">
Finally, make sure the information in this form is correct, because the only
way to correct it will be to remove this timetable schema and recreate it.
</p>

<div class="buttons"
     tal:define="tabindex python:ncols*(nrows+3)+7*nperiods+40">
  <input type="submit" class="button" name="CREATE"
         value="Create timetable schema"
         tal:attributes="tabindex python:tabindex"
         i18n:attributes="value" />
</div>

</form>

</metal:block>
</body>
</html>
