<html metal:use-macro="view/macros/page" i18n:domain="schooltool">
<head>
  <title metal:fill-slot="title" i18n:translate="">Person info</title>
</head>
<body>
  <h1 metal:fill-slot="h1" i18n:translate="">
    Person info for <span tal:replace="context/title" i18n:name="title"/>
  </h1>
  <metal:block metal:fill-slot="content" tal:define="info view/info">
    <div class="actions">
      <a class="action" tal:condition="view/canEdit"
         tal:attributes="href view/editURL"
         i18n:translate="">Edit</a>
      <a class="action" tal:condition="view/canChangePassword"
         tal:attributes="href view/passwordURL"
         i18n:translate="">Change password</a>
      <a class="action" tal:condition="view/canViewCalendar"
         tal:attributes="href string:${context/@@absolute_url}/calendar"
         i18n:translate="">View calendar</a>
      <a class="action"
          tal:attributes="href string:/residences/add.html?pid=${context/__name__}"
         i18n:translate="">Add residence</a>
    </div>
    <div class="actions" tal:condition="view/canEdit">
        <tal:loop repeat="facet view/getAvailableDynamicFacets">
            <a class="action"
                tal:attributes="href string:${view/editDynamicFacetURL}?facet=${facet}"
                tal:content="facet"></a>
        </tal:loop>
    </div>

    <div tal:condition="view/canChooseCalendars" class="groups">
      <form method="POST" class="plain"
            tal:attributes="action request/path">
        <h3 i18n:translate="">Groups</h3>
        <tal:block define="parent_groups view/getParentGroups"
                   condition="parent_groups">
          <p i18n:translate="">Merge calendars:</p>
          <p tal:repeat="group parent_groups">
            <input type="checkbox"
                   tal:attributes="name string:group.${group/__name__};
                                   checked python:view.checked(group)" />
            <a tal:attributes="href group/@@absolute_url"
               tal:content="group/title"></a>
          </p>
          <input class="button" type="submit" name="CHOOSE_CALENDARS"
                 i18n:attributes="value" value="Update" />
        </tal:block>
      </form>
    </div>

    <div tal:condition="not:view/canChooseCalendars" class="groups">
      <h3 i18n:translate="">Groups</h3>
      <p tal:repeat="group view/getParentGroups">
       <a tal:attributes="href group/@@absolute_url"
          tal:content="group/title"></a>
      </p>
    </div>

    <div class="timetables"
         tal:define="timetables python:view.timetables(view.isManager())"
         tal:condition="timetables">
      <h3 i18n:translate="">Timetables</h3>
      <p tal:repeat="tt timetables">
       <a tal:omit-tag="tt/empty"
          tal:attributes="href tt/url" tal:content="tt/title"/>
       <tal:if tal:condition="view/isManager">
         (<a tal:attributes="href string:${tt/url}/setup.html"
             i18n:translate="">setup</a>)
       </tal:if>
      </p>
    </div>
    <div class="row"><b i18n:translate="">Username:</b>
      <span tal:replace="python:context.__name__">not_doe</span>
    </div>
    <div class="row"><b i18n:translate="">Title:</b>
      <span tal:replace="context/title">John, but not Doe</span>
    </div>
    <div class="row"><b i18n:translate="">First name:</b>
      <span tal:replace="info/first_name"></span>
    </div>
    <div class="row"><b i18n:translate="">Last name:</b>
      <span tal:replace="info/last_name"></span>
    </div>
    <div class="row"><b i18n:translate="">Date of birth:</b>
      <span tal:replace="info/date_of_birth"></span>
    </div>
    <div class="row"><b i18n:translate="">Comment:</b>
      <span tal:replace="info/comment"></span>
    </div>
    <div class="row">
      <b i18n:translate="">Photo:</b>
      <tal:block condition="not:view/photoURL" 
                 i18n:translate="">N/A</tal:block>
      <p tal:condition="view/photoURL">
        <img src="photo.jpg" tal:attributes="src view/photoURL" />
      </p>
    </div>

    <div class="family-relationships"
      tal:define="custodians context/getCustodians|nothing;
      children context/getWards|nothing">
      <tal:if condition="children">
        <h3 i18n:translate="">Children</h3>
        <ul>
          <tal:loop repeat="child children">
            <li>
              <a href="" tal:attributes="href child/@@absolute_url"
                tal:content="child/title">
              </a>
            </li>
          </tal:loop>
        </ul>
      </tal:if>
      <tal:if condition="custodians">
        <h3 i18n:translate="">Guardians</h3>
        <ul>
          <tal:loop repeat="custodian custodians">
            <li>
              <a href="" tal:attributes="href custodian/@@absolute_url"
                tal:content="custodian/title">
              </a>
            </li>
          </tal:loop>
        </ul>
        <a class="action"
            tal:attributes="href string:${context/@@absolute_url}/guardian/?pid=${context/__name__}"
            i18n:translate="">Add or remove a guardian</a>
      </tal:if>
      <tal:if condition="not:custodians">
        <h3>This person has no guardian defined.</h3>
        <a class="action"
            tal:attributes="href string:${context/@@absolute_url}/guardian/?pid=${context/__name__}"
            i18n:translate="">Link to Guardian</a>
      </tal:if>
    </div>

    <div class="residences"
        tal:define="residences context/getResidences"
        tal:condition="residences">
      <h3 i18n:translate="">Residences</h3>
      <ul>
        <tal:loop repeat="residence residences">
          <li>
            <a href="" tal:attributes="href residence/@@absolute_url"
              tal:content="residence/title"></a>
              <address tal:define="address residence/info">
                  <span tal:content="address/streetNr"
                      /> <span tal:content="address/thoroughfareName"/><br/>
                  <span tal:content="address/town"
                      /> <span tal:content="address/district"
                      />, <span tal:content="address/postcode"/>
              </address>
          </li>
        </tal:loop>
      </ul>
    </div>

    <tal:loop repeat="facet view/getDynamicFacets">
      <metal:macro use-macro="view/macros/dynamic-facet"/>
    </tal:loop>

</metal:block>
</body>
</html>
