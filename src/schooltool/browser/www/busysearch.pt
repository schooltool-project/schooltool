<html metal:use-macro="view/macros/page" i18n:domain="schooltool">
<head>
  <title metal:fill-slot="title" i18n:translate="">Search for resources</title>
</head>
<body>
<h1 metal:fill-slot="h1" i18n:translate="">
  Search for available resources
</h1>
<metal:block metal:fill-slot="content">

<form tal:attributes="action request/uri" method="POST" class="busysearch">

<div class="error" tal:content="view/status" tal:condition="view/status" />

<table class="busysearch">
<tr>
<td>
  <h3 i18n:translate="">Resource</h3>
  <select multiple="yes" name="resources"
          tal:define="selected python:request.args.get('resources', [])">
    <tal:block repeat="resource view/allResources">
    <option tal:define="path resource/@@path"
            tal:content="resource/title"
            tal:attributes="value path;
                            selected python:path in selected" />
    </tal:block>
  </select>
</td>

<td>
  <h3 i18n:translate="">Hours</h3>
  <select multiple="yes" name="hours"
          tal:define="selected python:request.args.get('hours', [])">
    <option tal:repeat="hr python:range(24)"
            tal:attributes="value hr; selected python:str(hr) in selected"
            tal:content="python:'%02d:00' % hr" />
  </select>
</td>

<td>
  <h3 i18n:translate="">Dates</h3>
  <div class="row" tal:replace="structure view/first_widget" />
  <div class="row" tal:replace="structure view/last_widget" />

  <h3 i18n:translate="">Duration</h3>
  <div class="row" tal:replace="structure view/duration_widget" />

  <div class="buttons">
    <input type="submit" name="SUBMIT" value="Search" class="button"
           i18n:attributes="value" />
  </div>
</td>
</tr>
</table>
</form>

<div tal:condition="view/can_search" class="available">
<tal:block define="results view/listResources">
<h3 i18n:translate="">Available time slots</h3>
<p tal:condition="not:results" i18n:translate="">
  No available time slots found.
</p>
<table class="available" tal:condition="results">
  <tr>
    <th i18n:translate="">Resource</th>
    <th i18n:translate="">Start</th>
    <th i18n:translate="">End</th>
    <th></th>
  </tr>
  <tal:block repeat="resource results">
  <tr tal:repeat="slot resource/slots">
    <td tal:content="resource/title">Resource</td>
    <td tal:content="slot/start">Start</td>
    <td tal:content="slot/end">Duration</td>
    <td>
      <form method="GET" class="plain"
            tal:attributes="action string:${resource/href}/book">
         <input type="hidden" name="start_date"
                tal:attributes="value slot/start_date"/>
         <input type="hidden" name="start_time"
                tal:attributes="value slot/start_time"/>
         <input type="hidden" name="duration"
                tal:attributes="value view/duration_widget/raw_value"/>
         <input type="submit" name="BOOK" value="Book" class="button"
                i18n:attributes="value"/>
      </form>
    </td>
  </tr>
  </tal:block>
</table>
</tal:block>
</div>

</metal:block>
</body>
</html>
