============
Demographics
============

We can add a person:

  >>> from zope.testbrowser.testing import Browser
  >>> browser = Browser()
  >>> browser.handleErrors = False
  >>> browser.addHeader('Authorization', 'Basic manager:schooltool')
  >>> browser.open('http://localhost/persons/@@add.html')
  >>> browser.getControl(name='form.title').value = 'foobar'
  >>> browser.getControl(name='form.username').value = 'foobar'
  >>> browser.getControl(name='form.last_name').value = 'barson'
  >>> browser.getControl('Add').click()

And we can edit its name info:

  >>> browser.open('http://localhost/persons/foobar/nameinfo/@@edit.html')
  >>> full_name = browser.getControl(name='form.full_name')
  >>> full_name.value = 'Someone Schooltool'
  >>> browser.getControl('Apply').click()
  >>> browser.open('http://localhost/persons/foobar/nameinfo/@@edit.html')
  >>> browser.getControl(name='form.full_name').value
  'Someone Schooltool'

We can also view the name info:

  >>> browser.open('http://localhost/persons/foobar/nameinfo')
  >>> 'Someone Schooltool' in browser.contents
  True

We can edit its demographics:

  >>> browser.open('http://localhost/persons/foobar/demographics/@@edit.html')
  >>> previous_school = browser.getControl(name='form.previous_school')
  >>> previous_school.value = 'Some text'
  >>> browser.getControl('Apply').click()

and view it:

  >>> browser.open('http://localhost/persons/foobar/demographics')
  >>> 'Some text' in browser.contents
  True

and its school data:
  
  >>> browser.open('http://localhost/persons/foobar/schooldata/@@edit.html')
  >>> id = browser.getControl(name='form.id')
  >>> id.value = 'ABC'
  >>> browser.getControl('Apply').click()
  >>> browser.open('http://loaclhost/persons/foobar/schooldata')
  >>> 'ABC' in browser.contents
  True

and various parent and emergency contact screens:

  >>> browser.open('http://localhost/persons/foobar/parent1/@@edit.html')
  >>> name = browser.getControl(name='form.name')
  >>> name.value = 'Zorro'
  >>> browser.getControl('Apply').click()

  >>> browser.open('http://localhost/persons/foobar/parent2/@@edit.html')
  >>> browser.open('http://localhost/persons/foobar/emergency1/@@edit.html')
  >>> browser.open('http://localhost/persons/foobar/emergency2/@@edit.html')
  >>> browser.open('http://localhost/persons/foobar/emergency3/@@edit.html')

We can also add people as CSV data:

  >>> browser.open('http://localhost/persons/@@person-csvimport.html')
  >>> csv = browser.getControl(name='csvtext')
  >>> csv.value = 'alpha, Alpha\nbeta, Beta'
  >>> browser.getControl(name="UPDATE_SUBMIT").click()

We can browse to the nameinfo of the newly added persons:

  >>> browser.open('http://localhost/persons/alpha/nameinfo')
  >>> browser.open('http://localhost/persons/beta/nameinfo')

We can also see the persons added so far in tabular display:

  >>> browser.open('http://localhost/persons/@@table.html')
  >>> 'alpha' in browser.contents
  True
  >>> 'beta' in browser.contents
  True
  >>> 'foobar' in browser.contents
  True

We can search for the persons:

  >>> browser.open('http://localhost/persons/@@search.html')
  >>> sb = browser.getControl(name="form.fulltext")
  >>> sb.value = '*a*'
  >>> browser.getControl(name="form.actions.submit").click()

Check that the persons appeared on the output of the search:

  >>> 'alpha' in browser.contents
  True

NOTE: shouldn't beta be there also ?

Check that the search didn't return un-matching cases:

  >>> 'foobar' in browser.contents
  False

We can also search on parents:

  >>> browser.open('http://localhost/persons/@@search.html')
  >>> sb = browser.getControl(name='form.parentName')
  >>> sb.value = 'Zorro'
  >>> browser.getControl(name='form.actions.submit').click()

Check that we found foobar, whose parent is Zorro:

  >>> 'foobar' in browser.contents
  True

But not alpha or beta:

  >>> 'alpha' in browser.contents
  False
  >>> 'beta' in browser.contents
  False

We can also do the same for the student id ABC:

  >>> browser.open('http://localhost/persons/@@search.html')
  >>> id = browser.getControl(name='form.studentId')
  >>> id.value = 'ABC'
  >>> browser.getControl(name='form.actions.submit').click()

Check that we found foobar, whose student id is ABC:

  >>> 'foobar' in browser.contents
  True

But not alpha or beta:

  >>> 'alpha' in browser.contents
  False
  >>> 'beta' in browser.contents
  False

There's a quick search form in the table view:
 
  >>> browser.open('http://localhost/persons/@@table.html')
  >>> sb = browser.getControl(name="form.fulltext")
  >>> sb.value = '*a*'
  >>> browser.getControl(name="form.actions.submit").click()
  >>> 'alpha' in browser.contents
  True
  >>> 'foobar' in browser.contents
  False

The user alpha is not a teacher:

  >>> browser.open("http://localhost/persons/alpha/")
  >>> "Teachers" in browser.contents
  False

but it can be:

  >>> browser.open('http://localhost/persons/alpha/@@groups.html')
  >>> 'Teachers' in browser.contents
  True
  >>> tc = browser.getControl(name="add_group.teachers")
  >>> tc.value = True
  >>> browser.getControl(name="ADD_GROUPS").click()

Now it should be a teacher:

  >>> browser.open("http://localhost/persons/alpha/")
  >>> "Teachers" in browser.contents
  True

Let's make alpha the advisor of beta:

  >>> browser.open("http://localhost/persons/beta/schooldata/")
  >>> "alpha" in browser.contents
  False
  >>> browser.open("http://localhost/persons/beta/schooldata/@@edit.html")
  >>> adv = browser.getControl(name="form.advisor")
  >>> adv.value = ["alpha"]
  >>> browser.getControl(name="form.actions.apply").click()
  >>> browser.open("http://localhost/persons/beta/schooldata/")
  >>> "Alpha" in browser.contents
  True

Let's put beta in the beta team:

  >>> browser.open("http://localhost/groups/+/addSchoolToolGroup.html")
  >>> t = browser.getControl(name="field.title")
  >>> t.value = "Gamma"
  >>> browser.getControl("Add").click()
  >>> browser.open("http://localhost/persons/beta/schooldata/")
  >>> "Gamma" in browser.contents
  False
  >>> browser.open("http://localhost/persons/beta/schooldata/@@edit.html")
  >>> adv = browser.getControl(name="form.team")
  >>> adv.value = ["gamma"]
  >>> browser.getControl(name="form.actions.apply").click()
  >>> browser.open("http://localhost/persons/beta/schooldata/")
  >>> "Gamma" in browser.contents
  True

Let's try removing the advisor and see that nothing crashes:

  >>> browser.open("http://localhost/persons/@@table.html")
  >>> delete = browser.getControl(name="delete.alpha")
  >>> delete.value = True
  >>> browser.getControl("Delete").click()
  >>> browser.getControl("Confirm").click()  
  >>> browser.open("http://localhost/persons/beta/schooldata/")
  >>> "Alpha" in browser.contents
  False
  >>> "Invalid teacher" in browser.contents
  True

Now let's try removing the team and see that nothing crashes:

  >>> browser.open("http://localhost/groups")
  >>> delete = browser.getControl(name="delete.gamma")
  >>> delete.value = True
  >>> browser.getControl("Delete").click()
  >>> browser.getControl("Confirm").click()  
  >>> browser.open("http://localhost/persons/beta/schooldata/")
  >>> "Gamma" in browser.contents
  False
  >>> "Invalid group" in browser.contents
  True 

