============
Demographics
============

We can add a person:

  >>> from zope.testbrowser.testing import Browser
  >>> browser = Browser()
  >>> browser.handleErrors = False
  >>> browser.addHeader('Authorization', 'Basic manager:schooltool')
  >>> browser.open('http://localhost/persons/@@add.html')
  >>> browser.getControl(name='form.title').value = 'foobar'
  >>> browser.getControl(name='form.username').value = 'foobar'
  >>> browser.getControl(name='form.last_name').value = 'barson'
  >>> browser.getControl('Add').click()

And we can edit its name info:

  >>> browser.open('http://localhost/persons/foobar/nameinfo/@@edit.html')
  >>> full_name = browser.getControl(name='form.full_name')
  >>> full_name.value = 'Someone Schooltool'
  >>> browser.getControl('Apply').click()
  >>> browser.open('http://localhost/persons/foobar/nameinfo/@@edit.html')
  >>> browser.getControl(name='form.full_name').value
  'Someone Schooltool'

We can also view the name info:

  >>> browser.open('http://localhost/persons/foobar/nameinfo')
  >>> 'Someone Schooltool' in browser.contents
  True

We can edit its demographics:

  >>> browser.open('http://localhost/persons/foobar/demographics/@@edit.html')
  >>> previous_school = browser.getControl(name='form.previous_school')
  >>> previous_school.value = 'Some text'
  >>> browser.getControl('Apply').click()

and view it:

  >>> browser.open('http://localhost/persons/foobar/demographics')
  >>> 'Some text' in browser.contents
  True

and its school data:
  
  >>> browser.open('http://localhost/persons/foobar/schooldata/@@edit.html')
  >>> id = browser.getControl(name='form.id')
  >>> id.value = 'ABC'
  >>> browser.getControl('Apply').click()
  >>> browser.open('http://loaclhost/persons/foobar/schooldata')
  >>> 'ABC' in browser.contents
  True

and various parent and emergency contact screens:

  >>> browser.open('http://localhost/persons/foobar/parent1/@@edit.html')
  >>> name = browser.getControl(name='form.name')
  >>> name.value = 'Zorro'
  >>> browser.getControl('Apply').click()

  >>> browser.open('http://localhost/persons/foobar/parent2/@@edit.html')
  >>> browser.open('http://localhost/persons/foobar/emergency1/@@edit.html')
  >>> browser.open('http://localhost/persons/foobar/emergency2/@@edit.html')
  >>> browser.open('http://localhost/persons/foobar/emergency3/@@edit.html')

We can also add people as CSV data:

  >>> browser.open('http://localhost/persons/@@person-csvimport.html')
  >>> csv = browser.getControl(name='csvtext')
  >>> csv.value = 'alpha, Alpha\nbeta, Beta'
  >>> browser.getControl(name="UPDATE_SUBMIT").click()

We can browse to the nameinfo of the newly added persons:

  >>> browser.open('http://localhost/persons/alpha/nameinfo')
  >>> browser.open('http://localhost/persons/beta/nameinfo')

We can also see the persons added so far in tabular display:

  >>> browser.open('http://localhost/persons/@@table.html')
  >>> 'alpha' in browser.contents
  True
  >>> 'beta' in browser.contents
  True
  >>> 'foobar' in browser.contents
  True

We can search for the persons:

  >>> browser.open('http://localhost/persons/@@search.html')
  >>> sb = browser.getControl(name="form.fulltext")
  >>> sb.value = '*a*'
  >>> browser.getControl(name="form.actions.submit").click()

Check that the persons appeared on the output of the search:

  >>> 'alpha' in browser.contents
  True

NOTE: shouldn't beta be there also ?

Check that the search didn't return un-matching cases:

  >>> 'foobar' in browser.contents
  False

We can also search on parents:

  >>> browser.open('http://localhost/persons/@@search.html')
  >>> sb = browser.getControl(name='form.parentName')
  >>> sb.value = 'Zorro'
  >>> browser.getControl(name='form.actions.submit').click()

Check that we found foobar, whose parent is Zorro:

  >>> 'foobar' in browser.contents
  True

But not alpha or beta:

  >>> 'alpha' in browser.contents
  False
  >>> 'beta' in browser.contents
  False

We can also do the same for the student id ABC:

  >>> browser.open('http://localhost/persons/@@search.html')
  >>> id = browser.getControl(name='form.studentId')
  >>> id.value = 'ABC'
  >>> browser.getControl(name='form.actions.submit').click()

Check that we found foobar, whose student id is ABC:

  >>> 'foobar' in browser.contents
  True

But not alpha or beta:

  >>> 'alpha' in browser.contents
  False
  >>> 'beta' in browser.contents
  False

There's a quick search form in the table view:
 
  >>> browser.open('http://localhost/persons/@@table.html')
  >>> sb = browser.getControl(name="form.fulltext")
  >>> sb.value = '*a*'
  >>> browser.getControl(name="form.actions.submit").click()
  >>> 'alpha' in browser.contents
  True
  >>> 'foobar' in browser.contents
  False
