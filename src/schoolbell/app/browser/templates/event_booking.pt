<tal:defs define="dummy view/update" />
<html metal:use-macro="view/@@standard_macros/page" i18n:domain="schooltool">
<head>
  <title metal:fill-slot="title" i18n:translate="">Resource Booking</title>
</head>
<body>
<metal:block metal:fill-slot="body">

<form tal:attributes="action request/URL" method="post" class="standalone" style="width: 75%">
  <h3 i18n:translate="">
    Resource Booking for <span i18n:name="title"
                               tal:replace="context/title">something</span>
  </h3>

  <fieldset>
    <div>
      <strong i18n:translate="">Title:</strong>
      <span tal:replace="context/title">not_doe</span>
    </div>
    <div>
      <strong i18n:translate="">Starts:</strong>
      <span tal:replace="python: context.dtstart.strftime('%Y-%m-%d %H:%M')">some date and time</span>
    </div>
    <div>
      <strong i18n:translate="">Ends:</strong>
      <span tal:replace="python: (context.dtstart + context.duration).strftime('%Y-%m-%d %H:%M')">some time</span>
    </div>
    <div tal:condition="context/recurrence">
      <strong i18n:translate="">This is a recurring event!</strong>
    </div>
  </fieldset>

  <input type="hidden" tal:condition="request/date|nothing"
         name="date" tal:attributes="value request/date" />
  <fieldset>
    <legend i18n:translate="">Available Resources</legend>
    <table class="event_booking">
      <tal:block tal:repeat="resource view/availableResources/sortby:title">
        <tr tal:attributes="class repeat/resource/parity">
          <td class="booked">
            <input type="checkbox"
                   value="booked"
                   tal:attributes="name resource/zope:name;
                                   id resource/zope:name;
                                   checked python: view.hasBooked(resource)" />
          </td>
          <th class="resource">
            <label tal:attributes="for resource/zope:name" tal:content="resource/title">Resource foo</label>
            <input type="hidden" tal:attributes="name string:marker-${resource/zope:name}"
                   value="1" />
          </th>
          <td tal:define="conflicting_events python:view.getConflictingEvents(resource)"
              tal:condition="conflicting_events">
            <fieldset style="text-align: left;">
              <legend i18n:translate="">Conflicting events</legend>
              <div>
                <div tal:repeat="event conflicting_events">
                  <a tal:attributes="href string:${event/context/@@absolute_url}/edit.html" tal:content="event/shortTitle" />
                    (<span tal:replace="python:event.dtstart.strftime('%H:%M')"/> -
                    <span tal:replace="python:event.dtend.strftime('%H:%M')"/>)
                  <tal:block tal:define="owner python: event.context.__parent__.__parent__">
                    <a tal:define="owner_url string:${owner/@@absolute_url}/calendar"
                       tal:attributes="href python: '%s/%s/' % (owner_url, context.dtstart.strftime('%Y-%m-%d'))" tal:content="owner/title">A Dude</a>
                  </tal:block>
                </div>
              </div>
            </fieldset>
          </td>
        </tr>
      </tal:block>
    </table>
  </fieldset>

  <div class="controls">
    <input type="submit" class="button-ok" name="UPDATE_SUBMIT" value="Book"
           i18n:attributes="value" />
    <input type="submit" class="button-cancel" name="CANCEL" value="Cancel"
           i18n:attributes="value cancel-button" />
  </div>

</form>
</metal:block>
</body>
</html>
