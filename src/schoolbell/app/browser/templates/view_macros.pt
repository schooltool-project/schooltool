<metal:block define-macro="page" i18n:domain="schoolbell">
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" type="text/css" href="layout.css"
          tal:attributes="href context/++resource++layout.css"/>
    <link rel="stylesheet" type="text/css" href="style.css"
          tal:attributes="href context/++resource++style.css"/>
    <script type="text/javascript" src="schoolbell.js"
            tal:attributes="src context/++resource++schoolbell.js">
    </script>
    <metal:block define-slot="title">
      <title i18n:translate="">SchoolBell</title>
    </metal:block>
    <metal:block metal:define-slot="extrahead" />
  </head>
  <body>
    <div id="header">
      <div class="logo">
        <a href=""
          tal:define="url context/schoolbell:app/@@absolute_url"
          tal:attributes="href url">
          <img src="logo.png" alt="SchoolTool" border="0"
            i18n:attributes="alt"
            tal:attributes="src context/++resource++logo.png"/>
        </a>
      </div>
      <div class="tools">
        <div class="breadcrumbs">
        <tal:for tal:repeat="breadcrumb context/@@absolute_url/breadcrumbs">
          <a tal:condition="repeat/breadcrumb/start"
             tal:attributes="href breadcrumb/url"
             i18n:translate="">top</a>
          <tal:if condition="not:repeat/breadcrumb/start">&#187;</tal:if>
          <a tal:condition="not:repeat/breadcrumb/start"
             tal:attributes="href breadcrumb/url"
             tal:content="breadcrumb/name|string:top">Breadcrumb</a>
        </tal:for>
        </div>
        <div
          tal:define="user request/principal;
                      url context/schoolbell:app/@@absolute_url"
          tal:on-error="nothing">

          <tal:if condition="not:user/schoolbell:authenticated">
            <a id="tools-login" i18n:translate=""
              tal:attributes="href string:${url}/@@login.html">Log in</a>
          </tal:if>

          <tal:if condition="user/schoolbell:authenticated"
                  define="person user/schoolbell:person">
            <div metal:define-macro="logged_user">

              <tal:span i18n:translate="">User:</tal:span>

              <tal:if condition="not:person">
                <span id="tools-zmi-principal" i18n:translate=""
                  tal:content="user/title">ZMI Principal</span>
              </tal:if>

              <tal:if condition="person">
                <a id="tools-principal" i18n:translate=""
                  tal:attributes="href person/@@absolute_url"
                  tal:content="user/title">Schoolbell Person</a> |
                <a id="tools-calendar" i18n:translate=""
                  tal:attributes="href person/calendar/@@absolute_url"
                  >My Calendar</a> |
                <tal:disable condition="nothing">
                  XXX Preferences view is not implemented yet
                <a id="tools-preferences" i18n:translate=""
                  tal:attributes="href string:${person/@@absolute_url}/preferences.html"
                  >My Preferences</a> |
                </tal:disable>
                <a id="tools-logout" i18n:translate=""
                  tal:attributes="href string:${url}/@@logout.html"
                  >Log out</a>
              </tal:if>

            </div>
          </tal:if>

        </div>
      </div>
    </div>
    <div id="columns">
      <metal:block define-slot="column-left">
        <div id="column-left">
          <div tal:replace="structure context/@@schoolbell_navigation" 
               tal:on-error="nothing"/>
          <div class="portlet"
               tal:condition="context/@@view_get_menu/schoolbell_actions">
            <h4 i18n:translate="">Actions</h4>
            <ul>
              <li tal:repeat="view context/@@view_get_menu/schoolbell_actions">
                <a tal:attributes="href view/action"
                   tal:content="view/title"
                   i18n:translate="" />
              </li>
            </ul>
          </div>
          <metal:block define-slot="column-left-extra"/>
        </div>
      </metal:block>
      <div id="column-center">
        <div id="content-header">
          <metal:block define-slot="content-header"/>
        </div>
        <div id="content-body">
          <metal:block define-slot="body"/>
        </div>
      </div>
      <div class="clearer">&nbsp;</div>
    </div>
    <div id="footer" i18n:translate="">
      <p>
        &copy; The Shuttleworth Foundation 2003 - <span>2005</span>:
        Supporting Social Innovation.
      </p>
      <p>
        SchoolTool&trade; is a Trademark of The Shuttleworth Foundation.
      </p>
    </div>
  </body>
</html>
</metal:block>

<metal:block define-macro="calendar-navigation" i18n:domain="schoolbell">
  <div id="calendar-navigation-context">
    <table cellpadding="0" cellspacing="0" width="100%">
      <tr>
        <td align="left" width="33%">
          <a id="calendar-navigation-context-previous"
             tal:attributes="href view/prev"
             ><img border="0" src="previous.png" alt="<<"
                   tal:attributes="src context/++resource++previous.png" />
              <span tal:replace="view/prev_title">Previous</span></a>
        </td>
        <td align="center">
          <a id="calendar-navigation-context-current"
             tal:attributes="href view/current"
             ><img border="0" src="current.png" alt=""
                   tal:attributes="src context/++resource++current.png" />
              <span tal:replace="view/current_title">Current</span></a>
        </td>
        <td align="right" width="33%">
          <a id="calendar-navigation-context-next"
             tal:attributes="href view/next"
             ><span tal:replace="view/next_title">Next</span>
              <img border="0" src="next.png" alt=">>"
                   tal:attributes="src context/++resource++next.png" /></a>
        </td>
      </tr>
    </table>
  </div>
</metal:block>

<metal:block define-macro="calendar-mode" i18n:domain="schoolbell">
  <div id="calendar-navigation">
    <a id="calendar-navigation-day"
       tal:attributes="href python:view.calURL('daily')"
       title="View daily calendar"
       i18n:attributes="title"
       i18n:translate=""><img tal:attributes="src context/++resource++day.png"
                              border="0"
                              alt="Daily"/></a>
    <a id="calendar-navigation-week"
       tal:attributes="href python:view.calURL('weekly')"
       title="View weekly calendar"
       i18n:attributes="title"
       i18n:translate=""><img tal:attributes="src context/++resource++week.png"
                              border="0"
                              alt="Weekly"/></a>
    <a id="calendar-navigation-month"
       tal:attributes="href python:view.calURL('monthly')"
       title="View monthly calendar"
       i18n:attributes="title"
       i18n:translate=""><img tal:attributes="src context/++resource++month.png"
                              border="0"
                              alt="Monthly"/></a>
    <a id="calendar-navigation-year"
       tal:attributes="href python:view.calURL('yearly')"
       title="View yearly calendar"
       i18n:attributes="title"
       i18n:translate=""><img tal:attributes="src context/++resource++year.png"
                              border="0"
                              alt="Yearly"/></a>
  </div>
</metal:block>

<metal:block define-macro="calendar-page" i18n:domain="schoolbell">
  <html metal:use-macro="view/@@standard_macros/page">

    <metal:block fill-slot="title">
      <title i18n:translate="">Calendar</title>
    </metal:block>

    <metal:block fill-slot="content-header">
      <h1 i18n:translate="">
        Calendar for <span tal:replace="context/title"
                           i18n:name="title" />
      </h1>
    </metal:block>

    <metal:block fill-slot="column-left-extra">
      <div metal:use-macro="view/@@standard_macros/calendar-portlets"/>
    </metal:block>

    <metal:block fill-slot="body">
        <div metal:use-macro="view/@@standard_macros/calendar-mode"/>
        <div class="calcontent">
          <h2 class="calendar-view-title" tal:content="view/title" />
          <div metal:use-macro="view/@@standard_macros/calendar-navigation" />
          <div metal:define-slot="calendar-body"/>
        </div>
    </metal:block>
  </html>
</metal:block>

<!-- BEGIN CALENDAR MACROS -->

<metal:block define-macro="portlet-calendar-overlay" i18n:domain="schoolbell">
  <div tal:replace="structure context/@@calendar_overlay"
       tal:on-error="nothing"/>
</metal:block>

<metal:block define-macro="portlet-calendar-jumpto" i18n:domain="schoolbell">
  <div id="portlet-jumpto" class="portlet">

    <h4 i18n:translate="">Jump To ...</h4>
    <form class="center">
      <div>
        <select name="jump" onChange="jumpTo(this);">
          <option value="" i18n:translate="">Month</option>
          <tal:loop repeat="month view/getJumpToMonths">
            <option
              tal:attributes="value string:monthly.html?date=2004-${month/value}-01"
              tal:content="month/label" />
          </tal:loop>
        </select>
      </div>
    </form>

    <form class="center">
      <div>
        <select name="jump" onChange="jumpTo(this);">
          <option value='' i18n:translate="">Year</option>
          <tal:loop repeat="year view/getJumpToYears">
            <option value="" i18n:translate=""
              tal:attributes="value string:yearly.html?date=${year/value}-11-01"
              tal:content="year/label" />
          </tal:loop>
        </select>
      </div>
    </form>
  </div>
</metal:block>


<metal:block define-macro="brief-month-view" i18n:domain="schoolbell">
  <table class="month" cellpadding="0" cellspacing="0">
    <tr>
      <th colspan="7" class="month-title"
          tal:define="mtit python:view.monthTitle(month[1][0].date)">
        <a tal:content="mtit"
            tal:attributes="href python:view.calURL('monthly',
                            month[1][0].date);
                            title mtit"/>
      </th>
    </tr>
    <tr tal:repeat="week month">
      <td tal:replace="structure
          python:view.renderRow(week, month[1][0].date.month)" />
    </tr>

  </table>

</metal:block>

<metal:block define-macro="portlet-calendar-view-month"
             i18n:domain="schoolbell">

  <div id="portlet-calendar-view-month" class="portlet">

      <tal:block define="month python:view.getMonth(view.prevMonth());">
          <metal:block use-macro="view/@@standard_macros/brief-month-view" />
      </tal:block>

      <tal:block define="month python:view.getMonth(view.cursor);">
          <metal:block use-macro="view/@@standard_macros/brief-month-view" />
      </tal:block>

      <tal:block define="month python:view.getMonth(view.nextMonth());">
          <metal:block use-macro="view/@@standard_macros/brief-month-view" />
      </tal:block>

  </div>

</metal:block>

<metal:block define-macro="portlet-tomorrow-events" i18n:domain="schoolbell">

  <tal:block define="next view/nextDay; nevents python:view.dayEvents(next)">
    <div id="portlet-next-day-events" class="portlet" tal:condition="nevents">
      <h4 i18n:translate="">Tomorrow's Events</h4>
      <ul>
      <tal:loop tal:repeat="nevent nevents">
        <li tal:condition="python: nevent.dtstart.date() == next"
            tal:attributes="style string:color: ${nevent/color2}">
          <b tal:content="python:nevent.dtstart.strftime('%H:%M')" />
          <span tal:replace="nevent/shortTitle">Event</span>
        </li>
      </tal:loop>
      </ul>
    </div>
  </tal:block>

</metal:block>

<metal:block define-macro="calendar-portlets">

  <metal:block use-macro="view/@@standard_macros/portlet-tomorrow-events"/>

  <metal:macro use-macro="view/@@standard_macros/portlet-calendar-overlay"/>

  <metal:block use-macro="view/@@standard_macros/portlet-calendar-jumpto"/>

  <metal:block use-macro="view/@@standard_macros/portlet-calendar-view-month"/>

</metal:block>

<!-- END CALENDAR MACROS -->

